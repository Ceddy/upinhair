<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyBlzfYzF61pvW82ud5oyOy7ihlgIifaMzU&sensor=false"></script>

<div id='container'>
	<h1><%= @stylists.count %> Stylists in <%= current_user.location %> </h1>
  <div id='map-canvas'></div>
	
  <script>
    var geocoder;
    var map;
    function initialize() {
      geocoder = new google.maps.Geocoder();

      /* TODO: Change this area to the default of the user's location */
      var latlng = new google.maps.LatLng(43.67023,-79.38676);
      var mapOptions = {
        zoom: 8,
        center: latlng,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      }
      
      map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
    }
    
    function codeAddress(addressIn) {
      var address = addressIn;
      geocoder.geocode( { 'address': address}, function(results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
          map.setCenter(results[0].geometry.location);

          var image = "<%= asset_path('map_markers/number_1.png') %>";
          var marker = new google.maps.Marker({
              map: map,
              position: results[0].geometry.location,
              title: "Stylists near your area",
              icon: image
          });
        } else {
          alert('Geocode was not successful for the following reason: ' + status);
        }
      });
    }

    initialize();
    // google.maps.event.addDomListener(window, 'load', initialize);
  </script>
  
  <% @stylists.each do |stylist| %>
	<div class='stylist-wrapper'>
		<div class='stylist-picture'>
			<img src=<%= stylist.user.pic %> />
		</div>
		<div class='stylist-result'>
			<h3><%= stylist.user.name %></h3>
			<p><%= stylist.user.location %> </br>
			insert rating picture here</p>
		</div>
	</div>

	<script>codeAddress('<%= stylist.user.location %>')</script>
	<% end %>
</div>